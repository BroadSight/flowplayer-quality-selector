/*!

   Flowplayer HTML5 quality selector plugin

   Copyright (c) 2016, Flowplayer Oy

   Released under the MIT License:
   http://www.opensource.org/licenses/mit-license.php

   revision: 341a65a

*/
var extension=function(e){e(function(t,i){"use strict";function a(e){return e.sources.some(function(e){return/mpegurl/i.test(e.type)})}function n(e){var t=document.createElement("video");return!!t.canPlayType(e).replace("no","")}function l(e,t){var i=/-(\d+p)(\.(mp4|webm))?$/.exec(e);if(i&&-1!==t.indexOf(i[1]))return i[1]}function r(){t.qualities&&t.qualities.length&&(c.removeClass(i,"quality-abr"),t.qualities.forEach(function(e){c.removeClass(i,"quality-"+e)}))}function u(e,t){if("abr"===e)return"abr";var i,a=parseInt(e,0);return t.forEach(function(e,n){n!=t.length-1||i||(i=e),parseInt(e)<=a&&parseInt(t[n+1])>a&&(i=e)}),i}function s(i,a,n){var l,r=!1,u=a===t.defaultQuality,s=t.quality||Math.min(t.video.height,t.video.width)+"p";l=s===t.defaultQuality?/(.+?)((\.(mp4|webm)$|$))/:/(-\d+p)?((\.(mp4|webm)$|$))/;var o=i.sources.map(function(e){if("abr"===a||n&&u||/mpegurl/i.test(e.type))return e;var i={type:e.type,src:e.src.replace(l,s===t.defaultQuality?"$1-"+a+"$2":u?"$2":"-"+a+"$2")};return i.src!==e.src&&(r=!0),i}),c=JSON.stringify(o);o.sort(function(e,t){var i,n=/mpegurl/i;return i="abr"===a?n.test(t.type)-n.test(e.type):n.test(e.type)-n.test(t.type)}),r=r||JSON.stringify(o)!==c;var f=e.extend({},i,{sources:o});return r?f:!1}var o=e.bean,c=e.common,f=!1,p=!1;t.conf.hlsjs!==!1&&e.engines.forEach(function(e){"hlsjs"===e.engineName&&e.canPlay("application/x-mpegurl",t.conf)&&(p=!0)}),t.pluginQualitySelectorEnabled||(t.pluginQualitySelectorEnabled=!0,e.support.inlineVideo&&(t.conf.qualities&&(t.conf.qualities="string"==typeof t.conf.qualities?t.conf.qualities.split(","):t.conf.qualities),o.on(i,"click",".fp-quality-selector li",function(e){var i=e.currentTarget;if(!c.hasClass(i,"active")){var a,n=t.finished?0:t.video.time,l=i.getAttribute("data-quality");if(a=s(t.video,l),t.quality=l,!a)return;f=!0,p&&a.hlsjs!==!1&&!t.live&&n&&"abr"===l&&(a.hlsjs={startPosition:n}),t.load(a,function(){f=!1,t.finished=!1,!n||t.live||a.hlsjs&&a.hlsjs.startPosition?a.hlsjs&&(a.hlsjs.startPosition=0):t.seek(n,function(){t.resume()})})}}),t.on("load",function(e,t,i){if(t.qualities=i.qualities||t.conf.qualities||[],t.defaultQuality=i.defaultQuality||t.conf.defaultQuality,"string"==typeof t.qualities&&(t.qualities=t.qualities.split(",")),t.quality){var a=u(t.quality,t.qualities),n=s(i,a,!f);!f&&n&&(e.preventDefault(),t.loading=!1,t.load(n))}}).on("ready",function(e,t,u){var s=/mpegurl/i.test(u.type)?"abr":l(u.src,t.qualities)||Math.min(u.height,u.width)+"p";r(),c.addClass(i,"quality-"+s);var o=c.find(".fp-ui",i)[0];if(c.removeNode(c.find(".fp-quality-selector",o)[0]),!(t.qualities.length<2)){t.quality=s;var f=c.createElement("ul",{"class":"fp-quality-selector"});o.appendChild(f),(a(u)&&n("application/x-mpegurl")||t.conf.swfHls)&&f.appendChild(c.createElement("li",{"data-quality":"abr","class":"abr"===s?"active":""},"Auto")),t.qualities.forEach(function(e){f.appendChild(c.createElement("li",{"data-quality":e,"class":e==s?"active":""},e))})}}).on("unload",function(){r(),c.removeNode(c.find(".fp-quality-selector",i)[0])})))})};"object"==typeof module&&module.exports?module.exports=extension:window.flowplayer&&extension(window.flowplayer);